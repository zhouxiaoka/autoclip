# å‰ç«¯æ‹–æ‹½æ’åºè°ƒè¯•æŒ‡å—

## é—®é¢˜ç¡®è®¤

é€šè¿‡åç«¯è¯Šæ–­ï¼Œæˆ‘ä»¬ç¡®è®¤äº†ä»¥ä¸‹å‡ ç‚¹ï¼š
- âœ… åç«¯APIå®Œå…¨æ­£å¸¸å·¥ä½œ
- âœ… æ‰€æœ‰APIç«¯ç‚¹å“åº”æ­£ç¡®
- âœ… æ•°æ®åº“æ•°æ®æ­£ç¡®
- âŒ å‰ç«¯æ²¡æœ‰å‘å‡ºAPIè¯·æ±‚ï¼ˆåç«¯æ—¥å¿—ä¸­æ— è®°å½•ï¼‰

## é—®é¢˜å®šä½

**é—®é¢˜å‡ºç°åœ¨å‰ç«¯ï¼** å‰ç«¯çš„æ‹–æ‹½æ’åºåŠŸèƒ½æ²¡æœ‰æ­£ç¡®è§¦å‘APIè°ƒç”¨ã€‚

## å‰ç«¯è°ƒè¯•æ­¥éª¤

### 1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·

1. åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€é¡¹ç›®è¯¦æƒ…é¡µé¢
2. æŒ‰ `F12` æˆ–å³é”® â†’ "æ£€æŸ¥å…ƒç´ " æ‰“å¼€å¼€å‘è€…å·¥å…·
3. åˆ‡æ¢åˆ° **Network** æ ‡ç­¾é¡µ
4. ç¡®ä¿è®°å½•ç½‘ç»œè¯·æ±‚ï¼ˆçº¢è‰²å½•åˆ¶æŒ‰é’®åº”è¯¥æ˜¯æ¿€æ´»çŠ¶æ€ï¼‰

### 2. æ£€æŸ¥æ‹–æ‹½åŠŸèƒ½æ˜¯å¦è§¦å‘

1. å°è¯•æ‹–æ‹½åˆé›†ä¸­çš„ç‰‡æ®µ
2. è§‚å¯Ÿ **Network** æ ‡ç­¾é¡µæ˜¯å¦æœ‰æ–°çš„APIè¯·æ±‚å‡ºç°
3. å¦‚æœæ²¡æœ‰APIè¯·æ±‚ï¼Œè¯´æ˜æ‹–æ‹½äº‹ä»¶æ²¡æœ‰æ­£ç¡®å¤„ç†

### 3. æ£€æŸ¥JavaScripté”™è¯¯

1. åˆ‡æ¢åˆ° **Console** æ ‡ç­¾é¡µ
2. å°è¯•æ‹–æ‹½æ’åºæ“ä½œ
3. æŸ¥çœ‹æ˜¯å¦æœ‰çº¢è‰²çš„é”™è¯¯ä¿¡æ¯
4. è®°å½•é”™è¯¯ä¿¡æ¯ä»¥ä¾¿è¿›ä¸€æ­¥è¯Šæ–­

### 4. æ£€æŸ¥ç»„ä»¶æ˜¯å¦æ­£ç¡®æ¸²æŸ“

1. åœ¨ **Elements** æ ‡ç­¾é¡µä¸­æ£€æŸ¥åˆé›†ç»„ä»¶
2. ç¡®è®¤æ‹–æ‹½ç›¸å…³çš„äº‹ä»¶å¤„ç†å™¨æ˜¯å¦æ­£ç¡®ç»‘å®š
3. æŸ¥çœ‹ç»„ä»¶çš„propså’Œstateæ˜¯å¦æ­£ç¡®

## å¯èƒ½çš„é—®é¢˜åŸå› 

### 1. æ‹–æ‹½åº“é—®é¢˜

**ç—‡çŠ¶**: æ‹–æ‹½æ“ä½œæ— æ•ˆæœï¼Œæ²¡æœ‰è§†è§‰åé¦ˆ
**æ£€æŸ¥**: 
- ç¡®è®¤æ˜¯å¦ä½¿ç”¨äº†æ‹–æ‹½åº“ï¼ˆå¦‚react-dnd, @dnd-kitç­‰ï¼‰
- æ£€æŸ¥æ‹–æ‹½åº“çš„ç‰ˆæœ¬å…¼å®¹æ€§
- æŸ¥çœ‹æ‹–æ‹½åº“çš„é…ç½®æ˜¯å¦æ­£ç¡®

### 2. äº‹ä»¶å¤„ç†å™¨æœªç»‘å®š

**ç—‡çŠ¶**: å¯ä»¥æ‹–æ‹½ä½†æ²¡æœ‰è§¦å‘å›è°ƒ
**æ£€æŸ¥**:
- æ£€æŸ¥ `onReorderClips` ç­‰å›è°ƒå‡½æ•°æ˜¯å¦æ­£ç¡®ä¼ é€’
- ç¡®è®¤ç»„ä»¶çš„propsæ˜¯å¦æ­£ç¡®æ¥æ”¶

### 3. çŠ¶æ€ç®¡ç†é—®é¢˜

**ç—‡çŠ¶**: æ‹–æ‹½åçŠ¶æ€æ²¡æœ‰æ›´æ–°
**æ£€æŸ¥**:
- æ£€æŸ¥storeä¸­çš„ `reorderCollectionClips` æ–¹æ³•æ˜¯å¦è¢«è°ƒç”¨
- åœ¨æ–¹æ³•å¼€å¤´æ·»åŠ  `console.log` ç¡®è®¤æ‰§è¡Œ

### 4. APIè°ƒç”¨è¢«æ‹¦æˆª

**ç—‡çŠ¶**: å‰ç«¯ä»£ç æ‰§è¡Œä½†APIè¯·æ±‚æ²¡å‘å‡º
**æ£€æŸ¥**:
- æ£€æŸ¥axiosé…ç½®
- æŸ¥çœ‹è¯·æ±‚æ‹¦æˆªå™¨æ˜¯å¦æœ‰é—®é¢˜
- ç¡®è®¤ç½‘ç»œè¿æ¥æ­£å¸¸

## å…·ä½“è°ƒè¯•ä»£ç 

### åœ¨CollectionPreviewModal.tsxä¸­æ·»åŠ è°ƒè¯•æ—¥å¿—

```typescript
const handleReorderClips = async (newClipIds: string[]) => {
  console.log('ğŸ”„ handleReorderClips called with:', newClipIds)
  
  try {
    console.log('ğŸ“¤ Calling onReorderClips...')
    await onReorderClips?.(collection.id, newClipIds)
    console.log('âœ… onReorderClips completed successfully')
    
    message.success('åˆé›†é¡ºåºå·²æ›´æ–°')
  } catch (error) {
    console.error('âŒ onReorderClips failed:', error)
    message.error('æ›´æ–°åˆé›†é¡ºåºå¤±è´¥')
  }
}
```

### åœ¨useProjectStore.tsä¸­æ·»åŠ è°ƒè¯•æ—¥å¿—

```typescript
reorderCollectionClips: async (projectId: string, collectionId: string, newClipIds: string[]) => {
  console.log('ğŸ¯ reorderCollectionClips called:', { projectId, collectionId, newClipIds })
  
  // ... ç°æœ‰ä»£ç  ...
  
  try {
    console.log('ğŸ“¤ Calling projectApi.reorderCollectionClips...')
    await projectApi.reorderCollectionClips(projectId, collectionId, newClipIds)
    console.log('âœ… API call successful')
  } catch (error) {
    console.error('âŒ API call failed:', error)
    // ... é”™è¯¯å¤„ç† ...
  }
}
```

### åœ¨api.tsä¸­æ·»åŠ è°ƒè¯•æ—¥å¿—

```typescript
reorderCollectionClips: (projectId: string, collectionId: string, clipIds: string[]): Promise<Collection> => {
  console.log('ğŸŒ API call: reorderCollectionClips', { projectId, collectionId, clipIds })
  
  const url = `/projects/${projectId}/collections/${collectionId}/reorder`
  console.log('ğŸ“¡ Request URL:', url)
  console.log('ğŸ“¦ Request data:', clipIds)
  
  return api.patch(url, clipIds)
}
```

## å¿«é€Ÿæµ‹è¯•æ–¹æ³•

åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­ç›´æ¥æµ‹è¯•APIè°ƒç”¨ï¼š

```javascript
// 1. æµ‹è¯•storeæ–¹æ³•
window.useProjectStore.getState().reorderCollectionClips(
  '86f9aa12-2f35-4618-b265-74b3d9a4cf2d',
  '5e5dafc8-f29a-4705-8e87-b2bb06f2a5de', 
  ['3d0bb0b6-dd8d-4105-9219-b1bce74c7b4a', '678a8c4b-16ac-4893-a8d9-1b28c3bb4c81']
)

// 2. ç›´æ¥æµ‹è¯•APIè°ƒç”¨
fetch('http://localhost:8000/api/v1/projects/86f9aa12-2f35-4618-b265-74b3d9a4cf2d/collections/5e5dafc8-f29a-4705-8e87-b2bb06f2a5de/reorder', {
  method: 'PATCH',
  headers: {
    'Content-Type': 'application/json'
  },
  body: JSON.stringify(['678a8c4b-16ac-4893-a8d9-1b28c3bb4c81', '3d0bb0b6-dd8d-4105-9219-b1bce74c7b4a'])
}).then(r => r.json()).then(console.log)
```

## é¢„æœŸç»“æœ

å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œä½ åº”è¯¥çœ‹åˆ°ï¼š

1. **Networkæ ‡ç­¾é¡µ**: å‡ºç°å¯¹ `/projects/.../collections/.../reorder` çš„PATCHè¯·æ±‚
2. **Consoleæ ‡ç­¾é¡µ**: çœ‹åˆ°ç›¸å…³çš„è°ƒè¯•æ—¥å¿—è¾“å‡º
3. **Response**: æ”¶åˆ° `{"message": "Collection clips reordered successfully", "clip_ids": [...]}`
4. **UIæ›´æ–°**: åˆé›†ä¸­ç‰‡æ®µçš„é¡ºåºç«‹å³æ›´æ–°

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. æŒ‰ç…§ä¸Šè¿°æ­¥éª¤è¿›è¡Œè°ƒè¯•
2. è®°å½•å‘ç°çš„é”™è¯¯ä¿¡æ¯
3. æ ¹æ®é”™è¯¯ä¿¡æ¯å®šä½å…·ä½“é—®é¢˜
4. ä¿®å¤å‰ç«¯ä»£ç ä¸­çš„é—®é¢˜

## è”ç³»æ”¯æŒ

å¦‚æœæŒ‰ç…§æ­¤æŒ‡å—ä»æ— æ³•è§£å†³é—®é¢˜ï¼Œè¯·æä¾›ï¼š
- æµè§ˆå™¨æ§åˆ¶å°çš„é”™è¯¯ä¿¡æ¯
- Networkæ ‡ç­¾é¡µçš„è¯·æ±‚è®°å½•æˆªå›¾
- å…·ä½“çš„æ“ä½œæ­¥éª¤æè¿°

