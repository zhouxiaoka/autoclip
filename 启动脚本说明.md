# AutoClip 启动脚本说明

## 📋 脚本概览

本项目现在包含以下统一启动脚本，替代了之前分散的启动方式：

### 1. 🚀 `start_autoclip.sh` - 完整启动脚本 (推荐首次使用)

**功能**: 完整的开发环境启动脚本，包含所有检查和初始化
- ✅ 环境检查 (Python3, Node.js, Redis等)
- ✅ 依赖安装 (自动创建requirements.txt)
- ✅ 虚拟环境创建和激活
- ✅ 数据库初始化
- ✅ 配置文件创建 (.env)
- ✅ 启动所有服务

**使用场景**: 
- 首次设置开发环境
- 长时间未使用后重新启动
- 需要完整环境检查时

```bash
./start_autoclip.sh
```

### 2. ⚡ `quick_start.sh` - 快速启动脚本 (日常开发推荐)

**功能**: 跳过检查，快速启动所有服务
- ✅ 快速启动所有核心服务
- ✅ 适用于已配置好的环境
- ✅ 启动速度更快

**使用场景**:
- 日常开发启动
- 环境已配置完毕
- 快速重启服务

```bash
./quick_start.sh
```

### 3. 🛑 `stop_autoclip.sh` - 停止脚本

**功能**: 安全停止所有AutoClip相关服务
- ✅ 停止后端API服务器
- ✅ 停止Celery工作进程  
- ✅ 停止前端开发服务器
- ✅ 可选停止Redis服务器

```bash
./stop_autoclip.sh
```

## 🏗️ 启动的服务模块

### 核心服务
1. **Redis服务器** (端口: 6379)
   - 作用: Celery消息代理和结果存储
   - 自动检查并启动

2. **后端API服务器** (端口: 8000)
   - 技术栈: FastAPI + SQLAlchemy
   - 功能: REST API、WebSocket、数据库管理
   - 地址: http://localhost:8000
   - API文档: http://localhost:8000/docs

3. **Celery工作进程**
   - 作用: 异步任务处理 (视频处理、文件上传等)
   - 配置: 单进程模式，适合开发环境

4. **前端开发服务器** (端口: 3000)
   - 技术栈: React + TypeScript + Vite
   - 功能: 用户界面、状态管理(Zustand)、实时通信
   - 地址: http://localhost:3000

### 集成功能
- **WebSocket实时通信**: 任务进度推送、状态更新
- **Zustand状态管理**: 前端全局状态管理
- **SQLite数据库**: 数据持久化存储
- **文件管理**: 上传、处理、输出管理

## 📁 项目结构说明

```
autoclip/
├── start_autoclip.sh      # 完整启动脚本 ⭐
├── quick_start.sh         # 快速启动脚本 ⭐  
├── stop_autoclip.sh       # 停止脚本 ⭐
├── start_celery_worker.sh # (已整合) 单独Celery启动
├── scripts/
│   ├── start_dev.sh       # (已整合) 旧版开发启动
│   ├── start_backend.py   # (已整合) 后端启动
│   └── run_tests.py       # 测试运行脚本
├── backend/               # 后端代码
├── frontend/              # 前端代码  
└── requirements.txt       # Python依赖 (自动生成)
```

## 🔧 环境要求

### 必需组件
- **Python 3.8+**: 后端运行环境
- **Node.js 16+**: 前端开发环境
- **Redis**: 消息队列和缓存
- **Git**: 版本控制

### 自动安装的依赖
- Python虚拟环境和包
- Node.js前端依赖
- Redis (通过Homebrew，如果未安装)

## 🛠️ 使用流程

### 首次启动
```bash
# 1. 克隆项目
git clone <repository-url>
cd autoclip

# 2. 运行完整启动脚本
./start_autoclip.sh

# 3. 编辑配置文件 (如需要)
nano .env
```

### 日常开发
```bash
# 启动服务
./quick_start.sh

# 停止服务  
./stop_autoclip.sh
```

## 📊 服务状态检查

### 检查服务是否运行
```bash
# 检查后端API
curl http://localhost:8000/api/v1/health

# 检查Redis
redis-cli ping

# 查看运行的进程
ps aux | grep -E "(uvicorn|celery|vite|redis)"
```

### 查看日志
```bash
# 后端日志
tail -f backend.log

# Celery日志 (在终端输出)
# 前端日志 (在终端输出)
```

## ⚠️ 常见问题

### 1. Celery模块找不到错误
```
ModuleNotFoundError: No module named 'backend'
```
**解决方案**: 
- 确保在项目根目录运行脚本
- 脚本已自动设置 `PYTHONPATH=.:$PYTHONPATH`
- 使用 `celery -A backend.core.celery_app` 而不是 `celery -A core.celery_app`

### 2. 端口被占用
```bash
# 查找占用端口的进程
lsof -i :8000  # 后端端口
lsof -i :3000  # 前端端口
lsof -i :6379  # Redis端口

# 停止占用进程
kill -9 <PID>
```

### 2. Redis连接失败
```bash
# 手动启动Redis
redis-server --port 6379

# 检查Redis状态
brew services list | grep redis
```

### 3. Python依赖问题
```bash
# 重新安装依赖
rm -rf venv .venv_deps_installed
./start_autoclip.sh
```

### 4. 前端启动失败
```bash
# 清理并重新安装
cd frontend
rm -rf node_modules package-lock.json
npm install
```

## 🎯 下一步

1. **API密钥配置**: 编辑`.env`文件，设置必要的API密钥
2. **测试功能**: 访问 http://localhost:3000 开始使用
3. **开发调试**: 使用 `./stop_autoclip.sh` 和 `./quick_start.sh` 进行快速开发迭代

## 🆘 技术支持

如遇问题，请检查：
1. 所有服务的启动日志
2. `.env`配置文件是否正确
3. 网络端口是否被占用
4. 系统依赖是否完整安装