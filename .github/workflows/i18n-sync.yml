name: I18n Documentation Sync

on:
  push:
    paths:
      - 'README.md'
      - 'README-EN.md'
      - '.github/README.md'
  pull_request:
    paths:
      - 'README.md'
      - 'README-EN.md'
      - '.github/README.md'

jobs:
  sync-docs:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        
    - name: Install dependencies
      run: |
        npm install -g markdown-link-check@latest
        npm install -g markdownlint-cli
        
    - name: Check markdown links (Warning Only)
      run: |
        echo "ðŸ” Checking markdown links (warnings only)..."
        npx markdown-link-check README.md || echo "âš ï¸  Warning: Some links in README.md may be broken"
        npx markdown-link-check README-EN.md || echo "âš ï¸  Warning: Some links in README-EN.md may be broken"
        npx markdown-link-check .github/README.md || echo "âš ï¸  Warning: Some links in .github/README.md may be broken"
        echo "âœ… Link check completed (warnings only, no failure)"
        
    - name: Lint markdown files (Warning Only)
      run: |
        echo "ðŸ” Linting markdown files (warnings only)..."
        markdownlint README.md || echo "âš ï¸  Warning: README.md has linting issues"
        markdownlint README-EN.md || echo "âš ï¸  Warning: README-EN.md has linting issues"
        markdownlint .github/README.md || echo "âš ï¸  Warning: .github/README.md has linting issues"
        echo "âœ… Linting completed (warnings only, no failure)"
        
    - name: Check language consistency (Warning Only)
      run: |
        echo "ðŸ” Checking language consistency (warnings only)..."
        if ! grep -q "è¯­è¨€.*English.*ä¸­æ–‡" README.md; then
          echo "âš ï¸  Warning: Language switcher may be missing in Chinese README"
        else
          echo "âœ… Language switcher found in Chinese README"
        fi
        
        if ! grep -q "Language.*English.*ä¸­æ–‡" README-EN.md; then
          echo "âš ï¸  Warning: Language switcher may be missing in English README"
        else
          echo "âœ… Language switcher found in English README"
        fi
        echo "âœ… Language consistency check completed (warnings only, no failure)"
        
    - name: Validate contact information (Warning Only)
      run: |
        echo "ðŸ” Checking contact information (warnings only)..."
        if ! grep -Eq '([A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,})|(è”ç³»|Contact).*(è¡¨å•|Issue|é£žä¹¦|å¾®ä¿¡|QQ|Discord|Telegram|Link|é“¾æŽ¥)' README.md; then
          echo "âš ï¸  Warning: Contact information may be missing in Chinese README"
        else
          echo "âœ… Contact information found in Chinese README"
        fi
        
        if ! grep -Eq '([A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,})|(è”ç³»|Contact).*(è¡¨å•|Issue|é£žä¹¦|å¾®ä¿¡|QQ|Discord|Telegram|Link|é“¾æŽ¥)' README-EN.md; then
          echo "âš ï¸  Warning: Contact information may be missing in English README"
        else
          echo "âœ… Contact information found in English README"
        fi
        echo "âœ… Contact information check completed (warnings only, no failure)"
        
    - name: Check Docker support (Warning Only)
      run: |
        echo "ðŸ” Checking Docker support documentation (warnings only)..."
        if ! grep -q "Docker" README.md; then
          echo "âš ï¸  Warning: Docker support may not be documented in Chinese README"
        else
          echo "âœ… Docker support found in Chinese README"
        fi
        
        if ! grep -q "Docker" README-EN.md; then
          echo "âš ï¸  Warning: Docker support may not be documented in English README"
        else
          echo "âœ… Docker support found in English README"
        fi
        echo "âœ… Docker support check completed (warnings only, no failure)"
        
    - name: Generate documentation report
      run: |
        echo "ðŸ“ Generating documentation report..."
        mkdir -p docs
        echo "# Documentation Sync Report" > docs/sync-report.md
        echo "" >> docs/sync-report.md
        echo "## Files Checked" >> docs/sync-report.md
        echo "- README.md (Chinese)" >> docs/sync-report.md
        echo "- README-EN.md (English)" >> docs/sync-report.md
        echo "- .github/README.md (GitHub Homepage)" >> docs/sync-report.md
        echo "" >> docs/sync-report.md
        echo "## Status" >> docs/sync-report.md
        echo "âœ… All documentation files are processed" >> docs/sync-report.md
        echo "â„¹ï¸  Checks are now in warning mode - no failures will block commits" >> docs/sync-report.md
        echo "â„¹ï¸  Please review any warnings above for documentation improvements" >> docs/sync-report.md
        echo "" >> docs/sync-report.md
        echo "## Workflow Changes" >> docs/sync-report.md
        echo "- All README checks are now non-blocking (warnings only)" >> docs/sync-report.md
        echo "- Link checks, linting, and content validation will not fail the build" >> docs/sync-report.md
        echo "- Warnings are provided for manual review and improvement" >> docs/sync-report.md
        echo "" >> docs/sync-report.md
        echo "Last updated: $(date)" >> docs/sync-report.md
        echo "âœ… Documentation report generated successfully"
        
    - name: Upload documentation report
      uses: actions/upload-artifact@v4
      with:
        name: documentation-report
        path: docs/sync-report.md
